%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#1a1a2e', 'primaryTextColor': '#e0e0e0', 'primaryBorderColor': '#4a9eff', 'lineColor': '#4a9eff', 'secondaryColor': '#16213e', 'tertiaryColor': '#0f3460', 'background': '#0d1117', 'mainBkg': '#1a1a2e', 'nodeBorder': '#4a9eff', 'clusterBkg': '#16213e', 'clusterBorder': '#4a9eff', 'edgeLabelBackground': '#1a1a2e', 'fontFamily': 'Inter, Segoe UI, sans-serif', 'fontSize': '13px' }}}%%
flowchart TD
    START(["<b>START</b>"]) --> INFRA & DATA

    subgraph left ["&nbsp;"]
        direction TB
        INFRA["<b>InfraAgent</b><br/>• MCP: k8s + Prometheus<br/>• infra_score<br/>• infra_findings"]
    end

    subgraph right ["&nbsp;"]
        direction TB
        DATA["<b>Data Collection (parallel)</b>"]
        DATA --> M["<b>NfMetricsAgent</b><br/>• MCP: Prometheus<br/>• Per-NF metrics"]
        DATA --> L["<b>NfLogsAgent</b><br/>• MCP: Loki<br/>• Per-NF logs"]
        DATA --> U["<b>UeTracesAgent</b><br/>• MCP: Loki<br/>• IMSI traces<br/>• Memgraph ingest"]
        M & L & U --> EQ["<b>EvidenceQuality</b><br/>• Compute quality score<br/>• Temporal correlation"]
    end

    INFRA --> RCA
    EQ --> RCA

    RCA["<b>RCAAgent</b><br/><i>Inputs:</i> infra_findings, metrics,<br/>logs, UE traces, DAG from Memgraph<br/><i>Process:</i> LLM analyze → Layer<br/>decision → Root cause"]

    RCA --> FIN["<b>Finalize</b>"]
    FIN --> END_NODE(["<b>END</b>"])

    style START fill:#16213e,stroke:#e94560,stroke-width:2px,color:#e0e0e0
    style INFRA fill:#1a1a2e,stroke:#4a9eff,stroke-width:2px,color:#e0e0e0
    style DATA fill:#1a1a2e,stroke:#4a9eff,stroke-width:2px,color:#e0e0e0
    style M fill:#16213e,stroke:#4a9eff,stroke-width:1px,color:#e0e0e0
    style L fill:#16213e,stroke:#4a9eff,stroke-width:1px,color:#e0e0e0
    style U fill:#16213e,stroke:#4a9eff,stroke-width:1px,color:#e0e0e0
    style EQ fill:#16213e,stroke:#4a9eff,stroke-width:1px,color:#e0e0e0
    style RCA fill:#0f3460,stroke:#e94560,stroke-width:2px,color:#e0e0e0
    style FIN fill:#16213e,stroke:#4a9eff,stroke-width:1px,color:#e0e0e0
    style END_NODE fill:#16213e,stroke:#e94560,stroke-width:2px,color:#e0e0e0
    style left fill:#0d1117,stroke:#4a9eff,stroke-width:1px,stroke-dasharray: 5 5,color:#e0e0e0
    style right fill:#0d1117,stroke:#4a9eff,stroke-width:1px,stroke-dasharray: 5 5,color:#e0e0e0
